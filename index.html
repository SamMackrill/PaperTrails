<!DOCTYPE html>
<html>
<head>
  <title>Paper Trails - Scientific History</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    /* Basic Reset & Body */
    body {
      font-family: sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #f4f4f4;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    h1 {
      color: #333;
      margin-bottom: 20px;
    }

    /* Controls */
    .controls {
      margin-bottom: 20px;
      background-color: #fff;
      padding: 10px 15px;
      border-radius: 5px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      display: flex;
      align-items: center;
      gap: 10px;
      z-index: 100; /* Keep controls above timeline */
    }

    .controls button {
      padding: 5px 10px;
      font-size: 16px;
      cursor: pointer;
      border: 1px solid #ccc;
      background-color: #eee;
      border-radius: 3px;
    }
    .controls button:hover {
      background-color: #ddd;
    }
    .zoom-level {
      font-weight: bold;
      min-width: 40px;
      text-align: right;
    }

    /* Timeline Container & Timeline */
    .timeline-container {
      width: 95%;
      max-width: 1200px; /* Max width on large screens */
      height: 450px; /* Adjust height as needed */
      overflow: hidden; /* Crucial for containing the scaled/translated timeline */
      border: 1px solid #ccc;
      background-color: #fff;
      position: relative; /* Needed for absolute positioning of timeline */
      cursor: grab;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .timeline-container:active {
        cursor: grabbing;
    }

    .timeline {
      position: relative; /* Child elements are positioned relative to this */
      height: 100%;
      /* Width is set dynamically by JS */
      transform-origin: 0 0; /* Zoom from the top-left */
      background-color: #ffffff;
      /* The main timeline axis line */
      border-bottom: 2px solid #333; /* This IS the timeline axis */
      box-sizing: border-box; /* Include border in height */
    }

    /* Timeline Axis Label (Optional, as axis is the border) */
    .timeline-axis-label {
        position: absolute;
        bottom: -20px; /* Position below the border */
        left: 50%;
        transform: translateX(-50%);
        font-size: 12px;
        color: #555;
    }

    /* Year Markers */
    .year-marker {
        position: absolute;
        bottom: 0; /* Align with the timeline border */
        width: 1px;
        height: 10px; /* Small tick */
        background-color: #888;
        transform: translateY(100%); /* Position top edge at the bottom border */
    }
    .year-marker.major {
        height: 20px; /* Taller tick for centuries */
        background-color: #333;
    }
    .year-marker span {
        position: absolute;
        top: 5px; /* Position label below tick (relative to top of marker) */
        left: 50%;
        transform: translateX(-50%);
        font-size: 10px;
        color: #555;
    }
     .year-marker.major span {
         font-weight: bold;
         color: #333;
     }


    /* Publication Diamonds */
    .publication {
      position: absolute;
      width: 12px;
      height: 12px;
      transform: rotate(45deg);
      cursor: pointer;
      z-index: 20; /* Above lines, below photos */
      /* background-color is set dynamically */
      border: 1px solid rgba(0,0,0,0.3); /* Subtle border */
      /* Position is set dynamically by JS */
    }
     .publication:hover {
         transform: rotate(45deg) scale(1.3);
         z-index: 21;
     }

    /* Scientist Photos */
    .scientist-photo {
      position: absolute;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      object-fit: cover; /* Crop image nicely */
      filter: grayscale(100%);
      border: 3px solid; /* Color set dynamically */
      cursor: pointer;
      z-index: 30; /* Above publications */
      background-color: #fff; /* BG for images that might have transparency */
      box-shadow: 0 1px 3px rgba(0,0,0,0.2);
      transition: filter 0.2s ease, transform 0.2s ease;
      /* Position is set dynamically */
    }
    .scientist-photo:hover {
        filter: grayscale(0%);
        transform: scale(1.1);
        z-index: 31;
    }

    /* Connecting Lines (SVG) */
    .timeline-svg {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%; /* Cover the entire timeline div */
        height: 100%;
        pointer-events: none; /* Allow clicks to pass through */
        z-index: 10; /* Below publications and photos */
        overflow: visible; /* Ensure lines aren't clipped if they slightly exceed bounds */
    }
    .connecting-line {
        stroke-width: 1.5px;
        /* stroke color set dynamically */
    }

    /* Modals */
    .modal {
      display: none; /* Hidden by default */
      position: fixed; /* Stay in place */
      z-index: 1000; /* Sit on top */
      left: 0;
      top: 0;
      width: 100%; /* Full width */
      height: 100%; /* Full height */
      overflow: auto; /* Enable scroll if needed */
      background-color: rgba(0,0,0,0.6); /* Black w/ opacity */
      align-items: center;
      justify-content: center;
      display: flex; /* Use flex for centering */
      visibility: hidden; /* Use visibility for transition */
      opacity: 0;
      transition: opacity 0.3s ease, visibility 0.3s ease;
    }
     .modal.visible {
         visibility: visible;
         opacity: 1;
     }

    .modal-content {
      background-color: #fefefe;
      margin: auto;
      padding: 25px;
      border: 1px solid #888;
      width: 80%;
      max-width: 600px;
      border-radius: 5px;
      position: relative;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      transform: scale(0.9); /* Start slightly smaller */
      transition: transform 0.3s ease;
    }
     .modal.visible .modal-content {
         transform: scale(1); /* Scale up when visible */
     }

    .modal-content h3 {
        margin-top: 0;
        color: #333;
        border-bottom: 1px solid #eee;
        padding-bottom: 10px;
        margin-bottom: 15px;
    }
     .modal-content p {
         line-height: 1.6;
         color: #555;
     }

    .close-button {
      color: #aaa;
      position: absolute;
      top: 10px;
      right: 15px;
      font-size: 28px;
      font-weight: bold;
    }

    .close-button:hover,
    .close-button:focus {
      color: black;
      text-decoration: none;
      cursor: pointer;
    }

  </style>
</head>
<body>

  <h1>Paper Trails: A Scientific History</h1>

  <div class="controls">
    <button id="zoom-in" title="Zoom In">+</button>
    <button id="zoom-out" title="Zoom Out">-</button>
    <button id="reset-zoom" title="Reset Zoom">Reset</button>
    <span>Zoom: <span class="zoom-level">100%</span></span>
  </div>

  <div class="timeline-container" id="timeline-container">
    <div class="timeline" id="timeline">
        <svg class="timeline-svg" id="timeline-svg"></svg>
        <div class="timeline-axis-label">Year</div>
    </div>
  </div>

  <div id="publication-modal" class="modal">
    <div class="modal-content">
      <span class="close-button" id="close-pub-modal">&times;</span>
      <h3 id="pub-modal-title">Publication Title</h3>
      <p id="pub-modal-abstract">Abstract details...</p>
    </div>
  </div>

  <div id="scientist-modal" class="modal">
    <div class="modal-content">
      <span class="close-button" id="close-sci-modal">&times;</span>
      <h3 id="sci-modal-name">Scientist Name</h3>
      <p><strong>Nationality:</strong> <span id="sci-modal-nationality"></span></p>
      <p><strong>Born:</strong> <span id="sci-modal-birth"></span></p> <p><strong>Died:</strong> <span id="sci-modal-death"></span></p> </div>
  </div>

  <script>
    const scientists = { // Data uses ISO 8601 format (YYYY-MM-DD)
      newton: {
        name: "Isaac Newton",
        color: "#e63946", // Red
        photo: "https://upload.wikimedia.org/wikipedia/commons/thumb/8/83/Sir_Isaac_Newton_%281689%29.jpg/440px-Sir_Isaac_Newton_%281689%29.jpg",
        nationality: "English",
        birth: "1643-01-04",
        death: "1727-03-31",
        publications: [
          { year: 1687, title: "Philosophiæ Naturalis Principia Mathematica", abstract: "Presented Newton's laws of motion and universal gravitation." }
        ]
      },
      weber: {
        name: "Wilhelm Weber",
        color: "#f4a261", // Orange
        photo: "https://upload.wikimedia.org/wikipedia/commons/thumb/a/a5/Weber%2C_Wilhelm_Eduard_LOC.jpg/440px-Weber%2C_Wilhelm_Eduard_LOC.jpg",
        nationality: "German",
        birth: "1804-10-24",
        death: "1891-06-23",
        publications: [
          { year: 1846, title: "Elektrodynamische Massbestimmungen", abstract: "Work on the electrodynamics of moving charges, relating electrical and light speed units." },
          { year: 1856, title: "On the Measurement of Electric Resistance", abstract: "Developed sensitive magnetometers and contributed to establishing absolute electrical units." }
        ]
      },
      maxwell: {
        name: "James Clerk Maxwell",
        color: "#2a9d8f", // Teal
        photo: "https://upload.wikimedia.org/wikipedia/commons/thumb/d/d1/James_Clerk_Maxwell.jpg/440px-James_Clerk_Maxwell.jpg",
        nationality: "Scottish",
        birth: "1831-06-13",
        death: "1879-11-05",
        publications: [
          { year: 1861, title: "On Physical Lines of Force", abstract: "Introduced the concept of displacement current and early forms of his equations." },
          { year: 1873, title: "A Treatise on Electricity and Magnetism", abstract: "Unified electricity, magnetism, and light into Maxwell's equations, predicting electromagnetic waves." }
        ]
      },
      heaviside: {
        name: "Oliver Heaviside",
        color: "#e9c46a", // Yellow
        photo: "https://upload.wikimedia.org/wikipedia/commons/thumb/7/70/Oliver_Heaviside.jpg/440px-Oliver_Heaviside.jpg",
        nationality: "English",
        birth: "1850-05-18",
        death: "1925-02-03",
        publications: [
          { year: 1885, title: "Electromagnetic Induction and its Propagation", abstract: "Reformulated Maxwell's equations into the vector calculus form commonly used today." },
          { year: 1902, title: "Theory of the Electric Telegraph", abstract: "Predicted the existence of the Kennelly–Heaviside layer (ionosphere)." }
        ]
      },
       planck: {
        name: "Max Planck",
        color: "#457b9d", // Blue
        photo: "https://upload.wikimedia.org/wikipedia/commons/thumb/a/a7/Max_Planck_%281858-1947%29.jpg/440px-Max_Planck_%281858-1947%29.jpg",
        nationality: "German",
        birth: "1858-04-23",
        death: "1947-10-04",
        publications: [
          { year: 1900, title: "Zur Theorie des Gesetzes der Energieverteilung im Normalspectrum", abstract: "Introduced the concept of quantized energy (Planck's constant) to explain black-body radiation, founding quantum theory." }
        ]
      },
       lorenz: {
        name: "Hendrik Lorentz",
        color: "#fca311", // Dark Orange
        photo: "https://upload.wikimedia.org/wikipedia/commons/thumb/4/40/Hendrik_Antoon_Lorentz.jpg/440px-Hendrik_Antoon_Lorentz.jpg",
        nationality: "Dutch",
        birth: "1853-07-18",
        death: "1928-02-04",
        publications: [
          { year: 1892, title: "La Théorie électromagnétique de Maxwell et son application aux corps mouvants", abstract: "Developed the Lorentz transformation equations, laying groundwork for special relativity." },
           { year: 1904, title: "Electromagnetic phenomena in a system moving with any velocity smaller than that of light", abstract: "Further refined the transformations used by Einstein in special relativity." }
        ]
      },
      einstein: {
        name: "Albert Einstein",
        color: "#1d3557", // Dark Blue
        photo: "https://upload.wikimedia.org/wikipedia/commons/thumb/d/d3/Albert_Einstein_Head.jpg/440px-Albert_Einstein_Head.jpg",
        nationality: "German/American",
        birth: "1879-03-14",
        death: "1955-04-18",
        publications: [
          { year: 1905, title: "Zur Elektrodynamik bewegter Körper", abstract: "Introduced the theory of special relativity." },
          { year: 1905, title: "Über einen die Erzeugung und Verwandlung des Lichtes betreffenden heuristischen Gesichtspunkt", abstract: "Explained the photoelectric effect using light quanta (photons)." },
          { year: 1915, title: "Die Feldgleichungen der Gravitation", abstract: "Presented the field equations of general relativity." }
        ]
      },
      deBroglie: {
          name: "Louis de Broglie",
          color: "#ffc300", // Gold
          photo: "https://upload.wikimedia.org/wikipedia/commons/thumb/5/59/Louis_de_Broglie_1929.jpg/440px-Louis_de_Broglie_1929.jpg",
          nationality: "French",
          birth: "1892-08-15",
          death: "1987-03-19",
          publications: [
              { year: 1924, title: "Recherches sur la théorie des quanta", abstract: "PhD thesis proposing the wave nature of electrons (wave-particle duality)." }
          ]
      },
       heisenberg: {
        name: "Werner Heisenberg",
        color: "#6a0dad", // Purple
        photo: "https://upload.wikimedia.org/wikipedia/commons/thumb/f/f8/Bundesarchiv_Bild183-R57262%2C_Werner_Heisenberg.jpg/440px-Bundesarchiv_Bild183-R57262%2C_Werner_Heisenberg.jpg",
        nationality: "German",
        birth: "1901-12-05",
        death: "1976-02-01",
        publications: [
          { year: 1925, title: "Über quantentheoretische Umdeutung kinematischer und mechanischer Beziehungen", abstract: "Formulated matrix mechanics, a version of quantum mechanics." },
          { year: 1927, title: "Über den anschaulichen Inhalt der quantentheoretischen Kinematik und Mechanik", abstract: "Introduced the uncertainty principle." }
        ]
      },
      dirac: {
        name: "Paul Dirac",
        color: "#007f5f", // Dark Green
        photo: "https://upload.wikimedia.org/wikipedia/commons/thumb/5/55/Dirac_4_cropped.jpg/440px-Dirac_4_cropped.jpg",
        nationality: "British",
        birth: "1902-08-08",
        death: "1984-10-20",
        publications: [
          { year: 1928, title: "The Quantum Theory of the Electron", abstract: "Introduced the Dirac equation, describing relativistic electrons and predicting antimatter (positrons)." }
        ]
      },
      dicke: {
        name: "Robert H. Dicke",
        color: "#8d99ae", // Slate Gray
        photo: "https://upload.wikimedia.org/wikipedia/en/thumb/a/a7/Robert_H_Dicke.jpg/440px-Robert_H_Dicke.jpg", // Check copyright if used outside fair use context
        nationality: "American",
        birth: "1916-05-06",
        death: "1997-03-04",
        publications: [
          { year: 1965, title: "Cosmic Black-Body Radiation", abstract: "Independently predicted the cosmic microwave background radiation (CMB) and was building an experiment to detect it when Penzias and Wilson made their discovery." }
        ]
      }
    };

    // DOM Elements
    const timelineContainer = document.getElementById('timeline-container');
    const timeline = document.getElementById('timeline');
    const timelineSvg = document.getElementById('timeline-svg');
    const zoomInButton = document.getElementById('zoom-in');
    const zoomOutButton = document.getElementById('zoom-out');
    const resetZoomButton = document.getElementById('reset-zoom');
    const zoomLevelDisplay = document.querySelector('.zoom-level');

    // Modals
    const pubModal = document.getElementById('publication-modal');
    const sciModal = document.getElementById('scientist-modal');
    const closePubModal = document.getElementById('close-pub-modal');
    const closeSciModal = document.getElementById('close-sci-modal');
    const pubModalTitle = document.getElementById('pub-modal-title');
    const pubModalAbstract = document.getElementById('pub-modal-abstract');
    const sciModalName = document.getElementById('sci-modal-name');
    const sciModalNationality = document.getElementById('sci-modal-nationality');
    const sciModalBirth = document.getElementById('sci-modal-birth');
    const sciModalDeath = document.getElementById('sci-modal-death');

    // Constants and State
    const START_YEAR = 1600;
    const END_YEAR = 1970;
    const YEAR_SPAN = END_YEAR - START_YEAR;
    const MIN_SCALE = 0.5;
    const MAX_SCALE = 3.0;
    const ZOOM_STEP = 0.1;
    const PHOTO_SIZE = 50; // px
    const PUBLICATION_SIZE = 12; // px
    const TIMELINE_BORDER_WIDTH = 2; // px, matches CSS border-bottom width
    const PHOTO_BASE_OFFSET_Y = 80; // Base distance of photo center above the timeline axis
    const PHOTO_VERTICAL_STAGGER = 70; // Additional vertical separation for alternating photos

    let currentScale = 1.0;
    let currentTranslateX = 0;
    let isDragging = false;
    let dragStartX = 0;
    let dragStartTranslateX = 0;

    // --- Helper Functions ---

    function updateTimelineTransform() {
      // Clamp translation to prevent excessive scrolling
      const containerWidth = timelineContainer.clientWidth;
      // Ensure offsetWidth is read after potential initial render adjustments
      const timelineCurrentWidth = timeline.offsetWidth;
      if (timelineCurrentWidth === 0) return; // Avoid division by zero if hidden or not rendered

      const timelineScaledWidth = timelineCurrentWidth * currentScale;

      // Max translate (usually 0, unless timeline is narrower than container)
      const maxTranslateX = Math.max(0, containerWidth - timelineScaledWidth);
      // Min translate (prevent scrolling past the right edge)
      const minTranslateX = containerWidth - timelineScaledWidth;

      // Handle case where timeline is narrower than container even at max zoom
      const effectiveMinTranslateX = timelineScaledWidth < containerWidth ? 0 : minTranslateX;

      currentTranslateX = Math.max(effectiveMinTranslateX, Math.min(maxTranslateX, currentTranslateX));

      // Apply transform
      timeline.style.transform = `translateX(<span class="math-inline">\{currentTranslateX\}px\) scale\(</span>{currentScale})`;
      zoomLevelDisplay.textContent = `${Math.round(currentScale * 100)}%`;
    }

    // --- Timeline Rendering ---

    function renderTimeline() {
      // Clear previous elements
      timeline.innerHTML = ''; // Clear HTML elements
       timelineSvg.innerHTML = ''; // Clear SVG lines

        // Re-add SVG container and axis label
        timeline.appendChild(timelineSvg);
        const axisLabel = document.createElement('div');
        axisLabel.className = 'timeline-axis-label';
        axisLabel.textContent = 'Year';
        timeline.appendChild(axisLabel);


      // Calculate base width (unscaled) - make it wide enough
      const baseTimelineWidth = timelineContainer.clientWidth * 3; // Start with a generous width
      timeline.style.width = `${baseTimelineWidth}px`;

      const timelineHeight = timelineContainer.clientHeight; // Height of the container/timeline div
       // Y position of the timeline axis (top edge of the bottom border)
       const axisY = timelineHeight - TIMELINE_BORDER_WIDTH;

       // Add Year Markers
       for (let year = START_YEAR; year <= END_YEAR; year += 10) {
           const isMajor = year % 100 === 0;
           const yearMarker = document.createElement('div');
           yearMarker.className = `year-marker ${isMajor ? 'major' : ''}`;

           const posX = ((year - START_YEAR) / YEAR_SPAN) * baseTimelineWidth;
           yearMarker.style.left = `${posX}px`;
           // CSS handles positioning relative to bottom

           const yearLabel = document.createElement('span');
           yearLabel.textContent = year;
           yearMarker.appendChild(yearLabel);
           timeline.appendChild(yearMarker);
       }


      // Store element references for line drawing
      const elementCoords = {}; // { pubId: {x, y}, photoId: {x, y} }

      let photoIndex = 0; // For staggering photos vertically

      Object.entries(scientists).forEach(([id, scientist]) => {
        if (!scientist.publications || scientist.publications.length === 0) {
          console.warn(`Scientist ${scientist.name} has no publications listed.`);
          return;
        }

        // Sort publications by year to find the first
        scientist.publications.sort((a, b) => a.year - b.year);
        const firstPub = scientist.publications[0];

        // --- Create and Position Photo ---
        const photoEl = document.createElement('img');
        photoEl.src = scientist.photo;
        photoEl.alt = scientist.name;
        photoEl.className = 'scientist-photo';
        photoEl.style.borderColor = scientist.color;
        photoEl.dataset.scientistId = id; // Link photo to data

        // Calculate photo position
        const photoYearX = ((firstPub.year - START_YEAR) / YEAR_SPAN) * baseTimelineWidth;
        const photoX = photoYearX - PHOTO_SIZE / 2; // Center horizontally over first pub year

        // Position photo relative to the timeline axis (axisY)
        const photoBaseY = axisY - PHOTO_BASE_OFFSET_Y; // Base Y for photo center
        const photoTopY = photoBaseY - (photoIndex % 2 === 0 ? 0 : PHOTO_VERTICAL_STAGGER); // Stagger from this base
        const photoStyleTop = photoTopY - PHOTO_SIZE / 2; // Calculate 'top' style property

        photoEl.style.left = `${photoX}px`;
        photoEl.style.top = `${photoStyleTop}px`;

        photoEl.addEventListener('click', () => showScientistModal(id));

        timeline.appendChild(photoEl);

        // Store coords for line drawing AFTER appending (offsetWidth/offsetTop available)
        elementCoords[`photo_${id}`] = {
            x: photoEl.offsetLeft + PHOTO_SIZE / 2,
            y: photoEl.offsetTop + PHOTO_SIZE / 2 // Center Y
        };


        // --- Create and Position Publications ---
        scientist.publications.forEach((pub, pubIndex) => {
          const pubEl = document.createElement('div');
          pubEl.className = 'publication';
          pubEl.style.backgroundColor = scientist.color;
          pubEl.dataset.title = pub.title;
          pubEl.dataset.abstract = pub.abstract;
          pubEl.dataset.scientistId = id; // Store for reference if needed
          pubEl.title = `<span class="math-inline">\{pub\.title\} \(</span>{pub.year})`; // Tooltip

          // Calculate publication position
          const pubX = ((pub.year - START_YEAR) / YEAR_SPAN) * baseTimelineWidth;

          // Position the CENTER of the diamond on the timeline axis (axisY)
          const pubStyleTop = axisY - (PUBLICATION_SIZE / 2); // 'top' style for the element
          const pubStyleLeft = pubX - (PUBLICATION_SIZE / 2); // 'left' style for the element

          pubEl.style.left = `${pubStyleLeft}px`;
          pubEl.style.top = `${pubStyleTop}px`;

          pubEl.addEventListener('click', () => showPublicationModal(pub.title, pub.abstract));

          timeline.appendChild(pubEl);

          // Store coords of the *first* publication's center for line drawing
          if (pubIndex === 0) {
              // Center X is simply pubX. Center Y is axisY.
              elementCoords[`pub_${id}_first`] = {
                  x: pubX,
                  y: axisY
              };
          }
        });

        photoIndex++; // Increment for next scientist's vertical position
      });

      // --- Draw Connecting Lines (SVG) ---
       Object.keys(scientists).forEach(id => {
            const photoCoord = elementCoords[`photo_${id}`];
            const firstPubCoord = elementCoords[`pub_${id}_first`];

            if (photoCoord && firstPubCoord) {
                const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                line.setAttribute('x1', photoCoord.x);
                line.setAttribute('y1', photoCoord.y);
                line.setAttribute('x2', firstPubCoord.x);
                line.setAttribute('y2', firstPubCoord.y); // Target the axis Y
                line.setAttribute('stroke', scientists[id].color);
                line.classList.add('connecting-line');
                timelineSvg.appendChild(line);
            }
       });


      // Apply initial transform after rendering
      updateTimelineTransform();
    }

    // --- Modal Handling ---

    function showPublicationModal(title, abstract) {
      pubModalTitle.textContent = title;
      pubModalAbstract.textContent = abstract || "No abstract available.";
      pubModal.classList.add('visible');
    }

    function showScientistModal(scientistId) {
      const scientist = scientists[scientistId];
      if (!scientist) return;

      sciModalName.textContent = scientist.name;
      sciModalNationality.textContent = scientist.nationality || 'N/A';
      // Display dates directly in ISO format (YYYY-MM-DD)
      sciModalBirth.textContent = scientist.birth || 'N/A';
      sciModalDeath.textContent = scientist.death || 'N/A';
      sciModal.classList.add('visible');
    }

    function closeModal() {
      pubModal.classList.remove('visible');
      sciModal.classList.remove('visible');
    }

    // --- Event Listeners ---

    // Zooming and Scrolling (Wheel)
    timelineContainer.addEventListener('wheel', (event) => {
      event.preventDefault();

      if (event.ctrlKey) { // Zooming
        const rect = timelineContainer.getBoundingClientRect();
        const mouseXRelative = event.clientX - rect.left;
        const zoomFactor = event.deltaY < 0 ? 1 + ZOOM_STEP : 1 - ZOOM_STEP;
        const newScale = Math.max(MIN_SCALE, Math.min(MAX_SCALE, currentScale * zoomFactor));
        const scaleChange = newScale / currentScale;

        currentTranslateX = mouseXRelative - (mouseXRelative - currentTranslateX) * scaleChange;
        currentScale = newScale;

      } else { // Scrolling (Panning)
        const deltaX = Math.sign(event.deltaX) * Math.min(Math.abs(event.deltaX), 50);
        const deltaY = Math.sign(event.deltaY) * Math.min(Math.abs(event.deltaY), 50);
        currentTranslateX -= (deltaX || deltaY);
      }

      updateTimelineTransform();
    }, { passive: false }); // passive: false needed for preventDefault()

     // Drag to Pan
    timelineContainer.addEventListener('mousedown', (event) => {
        if (event.button !== 0 || event.target.closest('.scientist-photo, .publication')) return;
        isDragging = true;
        dragStartX = event.clientX;
        dragStartTranslateX = currentTranslateX;
        timelineContainer.style.cursor = 'grabbing';
        timelineContainer.style.userSelect = 'none';
    });

    document.addEventListener('mousemove', (event) => {
        if (!isDragging) return;
        const dx = event.clientX - dragStartX;
        currentTranslateX = dragStartTranslateX + dx;
        updateTimelineTransform();
    });

     document.addEventListener('mouseup', () => {
        if (isDragging) {
            isDragging = false;
            timelineContainer.style.cursor = 'grab';
             timelineContainer.style.removeProperty('user-select');
        }
    });
     document.addEventListener('mouseleave', () => { // Stop dragging if mouse leaves document
          if (isDragging) {
            isDragging = false;
            timelineContainer.style.cursor = 'grab';
             timelineContainer.style.removeProperty('user-select');
        }
     });


     // Prevent dragging images causing issues
     timelineContainer.addEventListener('dragstart', (event) => {
        event.preventDefault();
     });


    // Zoom Buttons
    function applyZoom(newScale) {
        if (newScale === currentScale) return;
        const containerWidth = timelineContainer.clientWidth;
        const zoomOriginX = containerWidth / 2;
        const scaleChange = newScale / currentScale;
        currentTranslateX = zoomOriginX - (zoomOriginX - currentTranslateX) * scaleChange;
        currentScale = newScale;
        updateTimelineTransform();
    }

    zoomInButton.addEventListener('click', () => {
        applyZoom(Math.min(MAX_SCALE, currentScale + ZOOM_STEP));
    });

    zoomOutButton.addEventListener('click', () => {
        applyZoom(Math.max(MIN_SCALE, currentScale - ZOOM_STEP));
    });

    resetZoomButton.addEventListener('click', () => {
      currentScale = 1.0;
      currentTranslateX = 0;
      updateTimelineTransform();
    });

    // Modal Close Buttons
    closePubModal.addEventListener('click', closeModal);
    closeSciModal.addEventListener('click', closeModal);

    // Close modal if clicking background overlay
    pubModal.addEventListener('click', (event) => {
        if (event.target === pubModal) closeModal();
    });
    sciModal.addEventListener('click', (event) => {
        if (event.target === sciModal) closeModal();
    });
    // Close modal on Escape key
    window.addEventListener('keydown', (event) => {
        if (event.key === 'Escape') closeModal();
    });


    // Initial Render on Load
    window.addEventListener('load', renderTimeline);
